<template>
  <div id="teacher" class="shadow">
    <div class="container-fluid jumbotron">
      <div class="">
        <h4 class="text-center text-success mb-4">ข้อมูลนักเรียน</h4>
      </div>
      <div class="mt-3 shadow">
        <vue-good-table
          :columns="columns"
          :rows="profiles"
          :line-numbers="true"
          styleClass="vgt-table striped bordered"
          :search-options="{
            enabled: true,
            placeholder: 'ค้นหา',
          }"
          :pagination-options="{
            enabled: true,
          }"
          compactMode
        >
          <!-- props.row คือ doc.data() -->
          <template slot="table-row" slot-scope="props">
            <span v-if="props.column.field == 'status'">
              <select
                @change="changeStatus(props.row.uid, $event)"
                class="custom-select"
              >
                <option :selected="props.row.role.isStudent" value="isStudent">Active</option>
                <option :selected="props.row.role.isInactive" value="isInactive">Inactive</option>
                <option :selected="props.row.role.isDrop" value="isDrop">Drop</option>
              </select>
            </span>
            <span v-else-if="props.column.field == 'fullProfile'">
              <div
                class="btn btn-secondary"
                data-toggle="modal"
                data-target="#profileModal"
                @click="fullProfile(props.row)"
              >
                <i class="fa-solid fa-user"></i>
              </div>
            </span>
            <!-- class="btn btn-success"
                @click="addcoursepage(props.row.uid)" -->
            <!-- data-toggle="modal"
                data-target="#addCourseModal" -->
            <span v-else-if="props.column.field == 'addcourse'">
              <div
                class="btn btn-success"
                data-toggle="modal"
                data-target="#addCourseModal"
                @click="addcourse(props.row)"
              >
                <i class="fa-solid fa-file-circle-plus"></i>
              </div>
            </span>
            <!-- @click="Reneval(props.row)" -->
            <span v-else-if="props.column.field == 'Reneval'">
              <div
                class="btn btn-info"
                data-toggle="modal"
                data-target="#RenevalModal"
              >
                <i class="fa-solid fa-user-plus"></i>
              </div>
            </span>
            <span v-else-if="props.column.field == 'data'">
              <div
                class="btn btn-dark"
                data-toggle="modal"
                data-target="#RenevalModal"
              >
                <i class="fas fa-table"></i>
              </div>
            </span>
            <span v-else-if="props.column.field == 'edit'">
              <div
                class="btn btn-warning dropdown-toggle"
                id="dropdownMenuButton"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fas fa-edit"></i>
              </div>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <router-link
                  to="/admin/editinvoice"
                  class="dropdown-item"
                  href="#"
                  >ข้อมูลวิชาเรียนและใบเสร็จ</router-link
                >

                <div
                  class="dropdown-item btn"
                  @click="editprofile(props.row)"
                  data-toggle="modal"
                  data-target="#profileModal"
                >
                  ข้อมูลส่วนตัว
                </div>
              </div>
            </span>
            <span v-else-if="props.column.field == 'delete'">
              <div class="btn btn-danger" @click="deleteTeacher(props.row.uid)">
                <i class="fas fa-trash-alt"></i>
              </div>
            </span>
            <!-- <span v-else>
        {{props.formattedRow[props.column.field]}}
      </span>       -->
          </template>
        </vue-good-table>
      </div>

      <!-- print invoice -->
      <div class="col" id="InvPckPrint" style="display: none">
        <div class="page" size="A4" style="page-break-after: always">
          <table
            width="100%"
            style="margin: 10px 0; border-bottom: 3px #000000 solid"
          >
            <tr>
              <td
                class="text-center"
                style="
                  font-weight: bolder;
                  font-size: 1.75em;
                  padding-top: 10px;
                "
              >
                <img
                  src="https://www.mmsmelodious.info/images/logo/medium-1594270995740.png"
                  alt="Logo"
                  style="width: 150px"
                />
              </td>
              <td colspan="2" class="text-center">
                <h4>โรงเรียนสอนดนตรี เมโลดิอุส</h4>
                <h5>Melodious Music School</h5>
                <p>
                  188/77-78 หมู่4 ชั้น2 ถ.หนามแดง-บางพลี ต.บางพลีใหญ่ อ.บางพลี
                  จ.สมุทราปราการ 10540
                </p>
                <p>
                  Tel. 02-183-9700 , 087-022-0277 , 091-5588700 Fax. 02-183-7492
                </p>
                <p>www.mmsmelodious.info , Email:mmsmelodious@gmail.com</p>
              </td>
              <td class="text-right">
                <h5>Inv.No. {{ invoiceNo }}</h5>
              </td>
            </tr>
          </table>

          <table width="100%">
            <tr>
              <td style="" colspan="4">
                <p class="text-left">ได้รับเงินจาก (Received from)</p>
              </td>
            </tr>
          </table>

          <table width="100%">
            <tr class="text-center">
              <td class="text-left">
                <h6>
                  ชื่อ - นามสกุล {{ std.firstName }} {{ std.lastName }} <br />
                </h6>
              </td>
              <td class="text-left">
                <h6>ชื่อเล่น {{ std.nickName }}</h6>
              </td>
              <td class="text-center">
                <h6>รหัสนักเรียน : {{ std.studentId }}</h6>
              </td>
              <td class="text-right">
                <h6>วันที่ {{ day }}</h6>
              </td>
            </tr>
          </table>
          <br />
          <table width="100%" class="mb-2">
            <tr class="text-left">
              <td colspan="4">
                (1):เพื่อชำระค่าเรียน <b>{{ paymentType }}</b>
                <label for=""></label>
              </td>
            </tr>
          </table>

          <table width="100%" class="table-bordered" style="text-align: center">
            <tr>
              <th style="width: 8%">ลำดับ<br />No.</th>
              <th style="width: 56%">
                รายละเอียดวิชาเรียน<br />Enrolled Course
              </th>
              <th style="width: 8%">จำนวน<br />Qty.</th>
              <th style="width: 12%">ค่าเรียนต่อคอร์ส<br />Tuition fee</th>
              <th style="width: 8%">ส่วนลด<br />Discount</th>
              <th style="width: 8%">รวมค่าเรียน<br />Total</th>
            </tr>
            <tr
              v-for="(course, index) in courses"
              :key="index"
              class="text-center"
            >
              <td>{{ index + 1 }}</td>
              <td>
                <span v-if="course.courseSelected"
                  >วิชา-{{ course.courseSelected }} ,</span
                >
                <span v-if="course.classTypeSelected"
                  >ชั้นเรียน-{{ course.classTypeSelected }}({{
                    course.levelSelected
                  }}) ,
                </span>
                <span v-if="course.startDate">
                  วันที่เริ่มเรียน-{{ course.startDate }} ,
                </span>
                <br />
                <span v-if="course.teacherSelected.teacherName">
                  อาจารย์ผู้สอน-{{ course.teacherSelected.teacherName }}
                </span>
              </td>
              <td>{{ course.qty }}</td>
              <td>{{ course.priceSelected }}</td>
              <td>{{ course.discount }}</td>
              <td>{{ course.qty * course.priceSelected - course.discount }}</td>
            </tr>
            <tr>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="3"
              ></td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="2"
              >
                รวมค่าเรียนทั้งสิ้น <br />Totol
              </td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
              >
                {{ subTotal }}
              </td>
            </tr>
          </table>
          <p><br /></p>

          <div class="mb-2">
            (2):เพื่อชำระค่า
            <span
              v-for="(item, index) in selected"
              :key="index"
              colspan="4"
              style="display: inline-block"
            >
              <b v-if="item == 'หนังสือเรียน'" class="text-left pl-2"
                >หนังสือเรียน ,</b
              >
              <b v-if="item == 'อุปกรณ์การเรียน'" class="text-left pl-2"
                >อุปกรณ์การเรียน ,</b
              >
              <b v-if="item == 'อื่นๆ'" class="text-left pl-2">{{
                payforDetail
              }}</b>
            </span>
          </div>

          <table width="100%" class="table-bordered" style="text-align: center">
            <tr>
              <th style="width: 8%">ลำดับ<br />No.</th>
              <th style="width: 56%">รายละเอียด<br />Description</th>
              <th style="width: 8%">จำนวน<br />Qty.</th>
              <th style="width: 12%">ราคา/หน่วย<br />unit price</th>
              <th style="width: 8%">ส่วนลด<br />Discount</th>
              <th style="width: 8%">รวม<br />Total</th>
            </tr>
            <tr v-for="(item, index) in carts" :key="index">
              <td>{{ index + 1 }}</td>
              <td>{{ item.pName }}</td>
              <td>{{ item.buyAmount }}</td>
              <td>{{ item.price }}</td>
              <td>{{ item.pDiscount }}</td>
              <td>{{ item.buyAmount * item.price - item.pDiscount }}</td>
            </tr>
            <tr>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="3"
              ></td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="2"
              >
                รวมค่าเรียนทั้งสิ้น <br />Totol
              </td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
              >
                {{ pSubtotal }}
              </td>
            </tr>
          </table>
          <p><br /></p>

          <div class="mb-2">
            ชำระเงินโดย (Pay by)
            <span
              v-for="(item, index) in payBy"
              :key="index"
              colspan="4"
              style="display: inline-block"
            >
              <b v-if="item == 'เงินสด'" class="text-left pl-2">เงินสด ,</b>
              <b v-if="item == 'เครดิตการ์ด'" class="text-left pl-2"
                >เครดิตการ์ด ,</b
              >
              <b v-if="item == 'โอนผ่านธนาคาร'" class="text-left pl-2">{{
                bankDetail
              }}</b>
            </span>
          </div>

          <table width="100%" class="table-bordered" style="text-align: center">
            <tr>
              <th style="width: 25%">(1)รวมค่าเรียน<br />Totol Tuition Fee</th>
              <th style="width: 25%">
                (2)ค่าหนังสือหรืออุปกรณ์<br />Total Amount
              </th>
              <th style="width: 25%">ค่าแรกเข้า<br />Enrollment fee</th>
              <th style="width: 25%">รวมจำนวนเงินทั้งสิ้น<br />Net Amount</th>
            </tr>
            <tr style="height: 50px">
              <td>{{ subTotal }}</td>
              <td>{{ pSubtotal }}</td>
              <td>{{ fee }}</td>
              <td>{{ grandTotal }}</td>
            </tr>
          </table>
          <br />
          <table width="100%" style="1px solid black">
            <tr class="text-left">
              <td colspan="4">
                จำนวนเงินรวมทั้งสิ้น (ตัวอักษร)
                Baht.______________________________________________________
              </td>
            </tr>
          </table>
          <br />
          <table width="100%" style="1px solid black">
            <tr class="text-left">
              <td colspan="4">หมายเหตุ {{ note }}</td>
            </tr>
          </table>
          <p><br /></p>
          <table width="100%">
            <tr class="float-right">
              <td colspan="3">
                <h6>
                  ลงชื่อ_______________________________________เจ้าหน้าที่/ผู้ดำเนินการ
                </h6>
                <br />
                <!-- <h6 class="text-center">ผู้รับเงิน</h6> -->
              </td>
            </tr>
          </table>
          <br />
          <i style="font-size: 10px"
            >โรงเรียนดนตรี เมโลดิอุส
            ขอสงวนสิทธิ์ที่จะไม่คืนค่าเรียนแก่ผู้สมัครไม่ว่ากรณีใดๆทั้งสิ้น</i
          >
          <br />
          <span style="font-size: 10px"
            >MMS reserve all the rights to not refund the tuition fees.</span
          >
        </div>
        <!-- PAGE PACKING LIST -->
        <div class="page" size="A4" style="page-break-after: always">
          <table
            width="100%"
            style="margin: 10px 0; border-bottom: 3px #000000 solid"
          >
            <tr>
              <td
                class="text-center"
                style="
                  font-weight: bolder;
                  font-size: 1.75em;
                  padding-top: 10px;
                "
              >
                <img
                  src="https://www.mmsmelodious.info/images/logo/medium-1594270995740.png"
                  alt="Logo"
                  style="width: 150px"
                />
              </td>
              <td colspan="2" class="text-center">
                <h4>โรงเรียนสอนดนตรี เมโลดิอุส</h4>
                <h5>Melodious Music School</h5>
                <p>
                  188/77-78 หมู่4 ชั้น2 ถ.หนามแดง-บางพลี ต.บางพลีใหญ่ อ.บางพลี
                  จ.สมุทราปราการ 10540
                </p>
                <p>
                  Tel. 02-183-9700 , 087-022-0277 , 091-5588700 Fax. 02-183-7492
                </p>
                <p>www.mmsmelodious.info , Email:mmsmelodious@gmail.com</p>
              </td>
              <td class="text-right">
                <h5>Inv.No. {{ invoiceNo }}</h5>
              </td>
            </tr>
          </table>

          <table width="100%">
            <tr>
              <td style="" colspan="4">
                <p class="text-left">ได้รับเงินจาก (Received from)</p>
              </td>
            </tr>
          </table>

          <table width="100%">
            <tr class="text-center">
              <td class="text-left">
                <h6>
                  ชื่อ - นามสกุล {{ std.firstName }} {{ std.lastName }} <br />
                </h6>
              </td>
              <td class="text-left">
                <h6>ชื่อเล่น {{ std.nickName }}</h6>
              </td>
              <td class="text-center">
                <h6>รหัสนักเรียน : {{ std.studentId }}</h6>
              </td>
              <td class="text-right">
                <h6>วันที่ {{ day }}</h6>
              </td>
            </tr>
          </table>
          <br />
          <table width="100%" class="mb-2">
            <tr class="text-left">
              <td colspan="4">
                (1):เพื่อชำระค่าเรียน <b>{{ paymentType }}</b>
                <label for=""></label>
              </td>
            </tr>
          </table>

          <table width="100%" class="table-bordered" style="text-align: center">
            <tr>
              <th style="width: 8%">ลำดับ<br />No.</th>
              <th style="width: 56%">
                รายละเอียดวิชาเรียน<br />Enrolled Course
              </th>
              <th style="width: 8%">จำนวน<br />Qty.</th>
              <th style="width: 12%">ค่าเรียนต่อคอร์ส<br />Tuition fee</th>
              <th style="width: 8%">ส่วนลด<br />Discount</th>
              <th style="width: 8%">รวมค่าเรียน<br />Total</th>
            </tr>
            <tr
              v-for="(course, index) in courses"
              :key="index"
              class="text-center"
            >
              <td>{{ index + 1 }}</td>
              <td>
                <span v-if="course.courseSelected"
                  >วิชา-{{ course.courseSelected }} ,</span
                >
                <span v-if="course.classTypeSelected"
                  >ชั้นเรียน-{{ course.classTypeSelected }}({{
                    course.levelSelected
                  }}) ,
                </span>
                <span v-if="course.startDate">
                  วันที่เริ่มเรียน-{{ course.startDate }} ,
                </span>
                <br />
                <span v-if="course.teacherSelected.teacherName">
                  อาจารย์ผู้สอน-{{ course.teacherSelected.teacherName }}
                </span>
              </td>
              <td>{{ course.qty }}</td>
              <td>{{ course.priceSelected }}</td>
              <td>{{ course.discount }}</td>
              <td>{{ course.qty * course.priceSelected - course.discount }}</td>
            </tr>
            <tr>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="3"
              ></td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="2"
              >
                รวมค่าเรียนทั้งสิ้น <br />Totol
              </td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
              >
                {{ subTotal }}
              </td>
            </tr>
          </table>
          <p><br /></p>

          <div class="mb-2">
            (2):เพื่อชำระค่า
            <span
              v-for="(item, index) in selected"
              :key="index"
              colspan="4"
              style="display: inline-block"
            >
              <b v-if="item == 'หนังสือเรียน'" class="text-left pl-2"
                >หนังสือเรียน ,</b
              >
              <b v-if="item == 'อุปกรณ์การเรียน'" class="text-left pl-2"
                >อุปกรณ์การเรียน ,</b
              >
              <b v-if="item == 'อื่นๆ'" class="text-left pl-2">{{
                payforDetail
              }}</b>
            </span>
          </div>

          <table width="100%" class="table-bordered" style="text-align: center">
            <tr>
              <th style="width: 8%">ลำดับ<br />No.</th>
              <th style="width: 56%">รายละเอียด<br />Description</th>
              <th style="width: 8%">จำนวน<br />Qty.</th>
              <th style="width: 12%">ราคา/หน่วย<br />unit price</th>
              <th style="width: 8%">ส่วนลด<br />Discount</th>
              <th style="width: 8%">รวม<br />Total</th>
            </tr>
            <tr v-for="(item, index) in carts" :key="index">
              <td>{{ index + 1 }}</td>
              <td>{{ item.pName }}</td>
              <td>{{ item.buyAmount }}</td>
              <td>{{ item.price }}</td>
              <td>{{ item.pDiscount }}</td>
              <td>{{ item.buyAmount * item.price - item.pDiscount }}</td>
            </tr>
            <tr>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="3"
              ></td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
                colspan="2"
              >
                รวมค่าเรียนทั้งสิ้น <br />Totol
              </td>
              <td
                style="
                  border-left: 0;
                  border-right: 0;
                  border-bottom: 6px black double;
                "
              >
                {{ pSubtotal }}
              </td>
            </tr>
          </table>
          <p><br /></p>

          <div class="mb-2">
            ชำระเงินโดย (Pay by)
            <span
              v-for="(item, index) in payBy"
              :key="index"
              colspan="4"
              style="display: inline-block"
            >
              <b v-if="item == 'เงินสด'" class="text-left pl-2">เงินสด ,</b>
              <b v-if="item == 'เครดิตการ์ด'" class="text-left pl-2"
                >เครดิตการ์ด ,</b
              >
              <b v-if="item == 'โอนผ่านธนาคาร'" class="text-left pl-2">{{
                bankDetail
              }}</b>
            </span>
          </div>

          <table width="100%" class="table-bordered" style="text-align: center">
            <tr>
              <th style="width: 25%">(1)รวมค่าเรียน<br />Totol Tuition Fee</th>
              <th style="width: 25%">
                (2)ค่าหนังสือหรืออุปกรณ์<br />Total Amount
              </th>
              <th style="width: 25%">ค่าแรกเข้า<br />Enrollment fee</th>
              <th style="width: 25%">รวมจำนวนเงินทั้งสิ้น<br />Net Amount</th>
            </tr>
            <tr style="height: 50px">
              <td>{{ subTotal }}</td>
              <td>{{ pSubtotal }}</td>
              <td>{{ fee }}</td>
              <td>{{ grandTotal }}</td>
            </tr>
          </table>
          <br />
          <table width="100%" style="1px solid black">
            <tr class="text-left">
              <td colspan="4">
                จำนวนเงินรวมทั้งสิ้น (ตัวอักษร)
                Baht.______________________________________________________
              </td>
            </tr>
          </table>
          <br />
          <table width="100%" style="1px solid black">
            <tr class="text-left">
              <td colspan="4">หมายเหตุ {{ note }}</td>
            </tr>
          </table>
          <p><br /></p>
          <table width="100%">
            <tr class="float-right">
              <td colspan="3">
                <h6>
                  ลงชื่อรับทราบ_______________________________________ผู้สมัคร/ผู้ปกครอง
                </h6>
                <br />
                <!-- <h6 class="text-center">ผู้รับเงิน</h6> -->
              </td>
            </tr>
          </table>
          <br />
          <i style="font-size: 10px"
            >โรงเรียนดนตรี เมโลดิอุส
            ขอสงวนสิทธิ์ที่จะไม่คืนค่าเรียนแก่ผู้สมัครไม่ว่ากรณีใดๆทั้งสิ้น</i
          >
          <br />
          <span style="font-size: 10px"
            >MMS reserve all the rights to not refund the tuition fees.</span
          >
        </div>
      </div>

      <!-- OUTPUT -->
    </div>

    <!--Start profileModal -->
    <div class="modal fade" id="profileModal">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h4
              v-if="profileModal == 'edit'"
              class="modal-title w-100 text-center text-warning"
            >
              แก้ไข ข้อมูลและประวัตินักเรียน
            </h4>
            <h4 v-else class="modal-title w-100 text-center text-success">
              ข้อมูลและประวัตินักเรียน
            </h4>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <div class="row">
              <div class="col-lg-12">
                <div id="preview">
                  <img
                    v-if="profile.image"
                    :src="profile.image"
                    class="rounded-circle mx-auto d-block"
                    width="220"
                    height="220"
                    style="border: 5px solid white"
                  />
                </div>
              </div>
            </div>

            <h6 class="text-success text-right my-3">
              วัน-เวลา ที่สมัคร {{ profile.addProfileAt }}
            </h6>
            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="namePrefix" class="text-success">คำนำหน้า</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกชื่อเล่น"
                    id="namePrefix"
                    :value="profile.namePrefix"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>

              <div class="col-lg-6">
                <div class="form-group">
                  <label for="nickName" class="text-success">ชื่อเล่น</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกชื่อเล่น"
                    id="nickName"
                    :value="profile.nickName"
                    :disabled="disabled == 1"
                  />
                  <!-- <span> : {{ profile.nickName }}</span> -->
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="firstName" class="text-success">ชื่อจริง</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกชื่อจริง"
                    id="firstName"
                    v-model.trim="profile.firstName"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="lastName" class="text-success">นามสกุล</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกนามสกุล"
                    id="lastName"
                    v-model.trim="profile.lastName"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="birthday" class="text-success"
                    >วัน/เดือน/ปี เกิด</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกนามสกุล"
                    id="lastName"
                    v-model.trim="profile.birthday"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">อีเมล์ </label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกอีเมล์มี @"
                    id="อีเมล์"
                    v-model.trim="profile.email"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="telephone" class="text-success"
                    >โทรศัพท์บ้าน</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    placeholder="ไม่มีให้ใส่ - "
                    id="telephone"
                    v-model.trim="profile.telephone"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="mobilephone" class="text-success"
                    >โทรศัพท์มือถือ</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกนามสกุล"
                    id="mobilephone"
                    v-model.trim="profile.mobilephone"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <hr />
            <h5 class="text-left text-success my-3 font-weight-bold">
              ข้อมูลผู้ปกครอง
            </h5>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="firstName" class="text-success">ชื่อจริง</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกชื่อจริง"
                    id="firstName"
                    v-model.trim="profile.parentFirstName"
                    :disabled="disabled == 1"
                  />
                  <!-- <span> : {{ profile.firstName }}</span> -->
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="lastName" class="text-success">นามสกุล</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกนามสกุล"
                    id="lastName"
                    v-model.trim="profile.parentLastName"
                    :disabled="disabled == 1"
                  />
                  <!-- <span> : {{ profile.lastName }}</span> -->
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="mobilephone" class="text-success"
                    >โทรศัพท์มือถือ</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกนามสกุล"
                    id="mobilephone"
                    v-model.trim="profile.parentMobilephone"
                    maxlength="10"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">อีเมล์ </label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกอีเมล์มี @"
                    id="อีเมล์"
                    v-model.trim="profile.parentEmail"
                    :disabled="disabled == 1"
                  />
                  <!-- <span> : {{ profile.email }}</span> -->
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="telephone" class="text-success"
                    >เกี่ยวข้องเป็น</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    placeholder="เกี่ยวข้องเป็น"
                    id="telephone"
                    v-model.trim="profile.parentAbout"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <!-- <div class="form-group">
            <label for="mobilephone" class="text-success">โทรศัพท์มือถือ</label>
            <input
              type="text"
              class="form-control"
              placeholder="กรอกนามสกุล"
              id="mobilephone"
              v-model.trim="profile.mobilephone"
            />
          </div> -->
              </div>
            </div>

            <hr />
            <h5 class="text-left text-success my-3 font-weight-bold">
              รายละเอียดที่อยู่
            </h5>
            <div class="row mt-3">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="addressNumber" class="text-success"
                    >บ้านเลขที่
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="กรอกบ้านเลขที่ ตัวอย่าง 99/99 หมู่ 9"
                    id="อีเมล์"
                    v-model.trim="profile.address.addressNumber"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="location" class="text-success"
                    >หมู่บ้าน/ร้าน/บริษัท/อาคาร
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="ไม่มีใส่ - "
                    id="location"
                    v-model.trim="profile.address.location"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">ตรอก/ซอย </label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="ไม่มีใส่ - "
                    id="อีเมล์"
                    v-model.trim="profile.address.soi"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">ถนน </label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกชื่อ ถนน"
                    id="อีเมล์"
                    v-model.trim="profile.address.road"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">แขวง/ตำบล</label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="ไม่มีใส่ - "
                    id="อีเมล์"
                    v-model.trim="profile.address.district"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">เขต/อำเภอ </label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกชื่อ ถนน"
                    id="อีเมล์"
                    v-model.trim="profile.address.amphoe"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">จังหวัด</label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="ไม่มีใส่ - "
                    id="อีเมล์"
                    v-model.trim="profile.address.province"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">รหัสไปรษณีย์ </label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกชื่อ ถนน"
                    id="อีเมล์"
                    v-model.trim="profile.address.zipcode"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>
            <hr />
            <h5 class="text-left text-success my-3 font-weight-bold">
              ประวัติการศึกษา
            </h5>
            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="level" class="text-success"> ระดับการศึกษา</label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกชื่อมหาวิทยาลัย"
                    id="email"
                    v-model.trim="profile.graduated.degree"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success"
                    >โรงเรียน / มหาวิทยาลัย</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกชื่อมหาวิทยาลัย"
                    id="email"
                    v-model.trim="profile.graduated.university"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success"
                    >ระดับชั้น / คณะ</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกคณะที่จบ"
                    id="email"
                    v-model.trim="profile.graduated.faculty"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="email" class="text-success">เอก/สาขาวิชา</label>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="กรอกเอก/สาขาวิชา"
                    id="email"
                    v-model.trim="profile.graduated.major"
                    :disabled="disabled == 1"
                  />
                </div>
              </div>
            </div>

            <hr />

            <h5 class="text-left text-success my-3 font-weight-bold">
              ประวัติการเรียน
            </h5>
            <div class="form-group">
              <textarea
                class="form-control"
                rows="5"
                id="comment"
                v-model="profile.studyHis"
                :disabled="disabled == 1"
              ></textarea>
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>

            <button
              @click="updateProfile(profile.uid)"
              type="button"
              class="btn btn-warning text-dark"
              v-if="profileModal == 'edit'"
            >
              แก้ไข
            </button>
          </div>
        </div>
      </div>
    </div>
    <!--End Modal เพิ่มเติม -->

    <!--Start Modal AddCourse -->
    <div class="modal fade" id="addCourseModal">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 text-center text-success">
              เพิ่มคอร์สเรียน
            </h4>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <div class="accordion" role="tablist" style="padding: 0">
              <b-card no-body class="mb-1">
                <b-card-header header-tag="header" class="p-1" role="tab">
                  <b-button block v-b-toggle.accordion-1 variant="success"
                    >วิชาเรียน</b-button
                  >
                </b-card-header>
                <b-collapse
                  id="accordion-1"
                  visible
                  accordion="my-accordion"
                  role="tabpanel"
                >
                  <b-card-body>
                    <div
                      class="mt-3 p-3"
                      style="background: #e9ecef"
                      v-for="(course, index) in courses"
                      :key="index"
                    >
                      <div class="row">
                        <div class="col-lg-12">
                          <div class="mb-1 float-right">
                            <button
                              type="button"
                              @click="deleteItem(index)"
                              class="btn btn-danger btn-circle btn-sm"
                            >
                              <i class="fas fa-times text-light"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <br />
                      <!-- <div class="col-lg-6">
                          <div class="form-group">
                            <label for="nickName" class="text-success"
                              >ราคา/คอร์ส</label
                            >
                            <vue-single-select
                              v-model="course.priceSelected"
                              :options="course.rate"
                              placeholder="เลือก ราคา/คอร์ส"
                            ></vue-single-select>
                          </div>
                        </div> -->
                      <div class="row">
                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="nickName" class="text-success"
                              >วิชาเรียน</label
                            >
                            <select
                              class="form-control"
                              id="namePrefix"
                              v-model="course.courseSelected"
                            >
                              <option disabled value="">เลือก วิชาเรียน</option>
                              <option
                                v-for="(item, index) in course.courseName"
                                :value="item"
                                :key="index"
                              >
                                {{ item }}
                              </option>
                            </select>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="nickName" class="text-success"
                              >รูปแบบการเรียน</label
                            >
                            <select
                              class="form-control"
                              id="namePrefix"
                              v-model="course.classTypeSelected"
                            >
                              <option disabled value="">
                                เลือก รูปแบบการเรียน
                              </option>
                              <option
                                v-for="(item, index) in course.courseType"
                                :value="item"
                                :key="index"
                              >
                                {{ item }}
                              </option>
                            </select>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="nickName" class="text-success"
                              >ระดับการเรียน</label
                            >
                            <select
                              class="form-control"
                              id="namePrefix"
                              v-model="course.levelSelected"
                            >
                              <option disabled value="">
                                เลือก ระดับการเรียน
                              </option>
                              <option
                                v-for="(item, index) in course.level"
                                :value="item"
                                :key="index"
                              >
                                {{ item }}
                              </option>
                            </select>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="nickName" class="text-success"
                              >อัตราค่าเรียน</label
                            >
                            <select
                              class="form-control"
                              id="namePrefix"
                              v-model="course.priceSelected"
                            >
                              <option disabled value="">
                                เลือก อัตราค่าเรียน
                              </option>
                              <option
                                v-for="(item, index) in course.rate"
                                :value="item"
                                :key="index"
                              >
                                {{ item }}
                              </option>
                            </select>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="namePrefix" class="text-success"
                              >ส่วนลด โปรโมชั่น</label
                            >
                            <div class="form-group">
                              <input
                                type="number"
                                class="form-control"
                                placeholder="กรอกเป็นตัวเลข"
                                min="0"
                                v-model.trim="course.discount"
                              />
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="" class="text-success"
                              >จำนวนครั้ง / คอร์ส</label
                            >
                            <div class="form-group">
                              <input
                                type="number"
                                class="form-control"
                                placeholder="กรอกเป็นตัวเลข"
                                v-model.trim="course.amount"
                              />
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="nickName" class="text-success"
                              >อาจารย์รายวิชา</label
                            >
                            <select
                              class="form-control"
                              id="namePrefix"
                              v-model="course.teacherSelected"
                            >
                              <option disabled value="">
                                เลือก อาจารย์รายวิชา
                              </option>
                              <option
                                v-for="(item, index) in course.teacher"
                                :value="{
                                  teacherId: item.uid,
                                  teacherName: item.fullName,
                                }"
                                :key="index"
                              >
                                {{ item.fullName }}
                              </option>
                            </select>
                            <!-- <span
                              >courseSelected:
                              {{ course.teacherSelected }}</span
                            > -->
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="namePrefix" class="text-success"
                              >ค่าสอนของครู</label
                            >
                            <div class="form-group">
                              <input
                                type="number"
                                class="form-control"
                                placeholder="กรอกเป็นตัวเลข"
                                min="0"
                                v-model.trim="course.wages"
                              />
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="" class="text-success"
                              >เริ่มเรียน เวลา</label
                            >
                            <div>
                              <b-form-timepicker
                                v-model="course.startTime"
                                locale="th"
                                placeholder="เลือก-เวลาเริ่มเรียน"
                              ></b-form-timepicker>
                              <!-- <div class="mt-2">Value: '{{ value }}'</div> -->
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="" class="text-success"
                              >เลิกเรียน เวลา</label
                            >
                            <div>
                              <b-form-timepicker
                                v-model="course.finishTime"
                                locale="th"
                                placeholder="เลือก-เวลาเลิกเรียน"
                              ></b-form-timepicker>
                              <!-- <div class="mt-2">Value: '{{ value }}'</div> -->
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="" class="text-success"
                              >วันที่เริ่มเรียน</label
                            >
                            <div>
                              <b-form-datepicker
                                v-model="course.startDate"
                                locale="th"
                                placeholder="เลือก-วันที่เริ่มเรียน"
                              ></b-form-datepicker>
                              <!-- <div class="mt-2">Value: '{{ value }}'</div> -->
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="" class="text-success"
                              >วันที่เรียนจบ โดยประมาณ</label
                            >
                            <div>
                              <b-form-datepicker
                                v-model="course.endDate"
                                locale="th"
                                placeholder="เลือก-วันที่เรียนจบ"
                              ></b-form-datepicker>
                              <!-- <div class="mt-2">Value: '{{ value }}'</div> -->
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="namePrefix" class="text-success"
                              >วันที่เลือกเรียน</label
                            >
                            <select
                              class="form-control"
                              id="namePrefix"
                              v-model="course.daySelected"
                            >
                              <option disabled value="">
                                วันที่เลือกเรียน
                              </option>
                              <option
                                v-for="(item, index) in course.day"
                                :key="index"
                                :value="{ dayNum: index + 1, item }"
                              >
                                {{ item }}
                              </option>
                            </select>
                            <!-- <span>courseSelected: {{ course.daySelected }}</span> -->
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group">
                            <label for="" class="text-success"
                              >จำนวนคอร์ส</label
                            >
                            <div class="form-group">
                              <input
                                type="number"
                                class="form-control"
                                placeholder="กรอกเป็นตัวเลข"
                                min="1"
                                v-model.trim="course.qty"
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col text-center mt-3 mr-3">
                        <button v-on:click="addNewItem" class="btn btn-success">
                          เพิ่มวิชาเรียน
                        </button>
                      </div>
                    </div>
                  </b-card-body>
                </b-collapse>
              </b-card>

              <b-card no-body class="mb-1">
                <b-card-header header-tag="header" class="p-1" role="tab">
                  <b-button block v-b-toggle.accordion-2 variant="success"
                    >หนังสือ - อุปกรณ์</b-button
                  >
                </b-card-header>
                <b-collapse
                  id="accordion-2"
                  accordion="my-accordion"
                  role="tabpanel"
                >
                  <b-card-body>
                    <vue-good-table
                      :columns="pColumns"
                      :rows="products"
                      :line-numbers="true"
                      styleClass="vgt-table striped bordered"
                      :search-options="{
                        enabled: true,
                        placeholder: 'ค้นหา',
                      }"
                      :pagination-options="{
                        enabled: true,
                      }"
                      compactMode
                    >
                      <template slot="table-row" slot-scope="props">
                        <span v-if="props.column.field == 'quantity'">
                          <h6>
                            {{ props.row.quantity - props.row.buyAmount }}
                          </h6>
                        </span>
                        <span
                          v-else-if="
                            props.column.field == 'price' &&
                            props.row.pMode == 'อื่นๆ'
                          "
                        >
                          <div class="form-group">
                            <input
                              type="number"
                              class="form-control"
                              placeholder="กรอกเป็นตัวเลข"
                              min="0"
                              v-model.trim="props.row.price"
                            />
                          </div>
                        </span>
                        <span v-else-if="props.column.field == 'buy'">
                          <div class="form-group">
                            <input
                              type="number"
                              class="form-control"
                              placeholder="กรอกเป็นตัวเลข"
                              min="0"
                              v-model.trim="props.row.buyAmount"
                            />
                          </div>
                        </span>
                        <span v-else-if="props.column.field == 'pDiscount'">
                          <div class="form-group">
                            <input
                              type="number"
                              class="form-control"
                              placeholder="กรอกเป็นตัวเลข"
                              min="0"
                              v-model.trim="props.row.pDiscount"
                            />
                          </div>
                        </span>
                        <span v-else-if="props.column.field == 'total'">
                          <h6>
                            {{
                              props.row.buyAmount * props.row.price -
                              props.row.pDiscount
                            }}
                          </h6>
                        </span>
                        <span v-else-if="props.column.field == 'cart'">
                          <div class="form-group">
                            <div
                              class="btn btn-info"
                              @click="addToCart(props.row)"
                            >
                              <i class="fas fa-cart-arrow-down"></i>
                            </div>
                          </div>
                        </span>
                        <span v-else>
                          {{ props.formattedRow[props.column.field] }}
                        </span>
                      </template>
                    </vue-good-table>
                  </b-card-body>
                </b-collapse>
              </b-card>

              <b-card no-body class="mb-1">
                <b-card-header header-tag="header" class="p-1" role="tab">
                  <b-button block v-b-toggle.accordion-3 variant="success"
                    >Invoice</b-button
                  >
                </b-card-header>
                <b-collapse
                  id="accordion-3"
                  accordion="my-accordion"
                  role="tabpanel"
                >
                  <b-card-body>
                    <div class="py-3" style="border: 1px solid green">
                      <h5 class="text-center text-success mt-3">วิชาเรียน</h5>
                      <h6 class="ml-3 mt-3 text-success">
                        เพื่อชำระค่าเรียน (Payment for tuition)
                      </h6>
                      <div class="form-check-inline ml-3">
                        <label class="form-check-label" for="">
                          <input
                            type="radio"
                            class="form-check-input"
                            id=""
                            name=""
                            value="ลงทะเบียนใหม่"
                            checked
                            v-model.trim="paymentType"
                          />ลงทะเบียนใหม่
                        </label>
                      </div>
                      <div class="form-check-inline">
                        <label class="form-check-label" for="radio2">
                          <input
                            type="radio"
                            class="form-check-input"
                            id=""
                            name=""
                            value="ต่อคอร์ส"
                            v-model.trim="paymentType"
                          />ต่อคอร์สเรียน
                        </label>
                      </div>
                      <div class="table-responsive">
                        <table
                          class="table table-bordered table-striped text-center"
                        >
                          <thead class="thead-light">
                            <tr>
                              <th>วิชา</th>
                              <th>จำนวน</th>
                              <th>ค่าเรียน/คอร์ส</th>
                              <th>ส่วนลด</th>
                              <th>รวม</th>
                              <th>ลบ</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr
                              v-for="(course, index) in courses"
                              :key="index"
                              class="text-center"
                            >
                              <td>{{ course.courseSelected }}</td>
                              <td>{{ course.qty }}</td>
                              <td>{{ course.priceSelected }}</td>
                              <td>{{ course.discount }}</td>
                              <td>
                                {{
                                  course.qty * course.priceSelected -
                                  course.discount
                                }}
                              </td>
                              <td>
                                <button
                                  type="button"
                                  @click="deleteItem(index)"
                                  class="btn btn-danger btn-sm"
                                >
                                  <i class="fas fa-times text-light"></i>
                                </button>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>

                    <div class="py-3 my-2" style="border: 1px solid green">
                      <h5 class="text-center text-success mt-3">
                        หนังสือ - อุปกรณ์
                      </h5>
                      <h6 class="ml-3 mt-3 text-success">
                        เพื่อชำระ (Payment for)
                      </h6>
                      <div class="row mx-auto">
                        <div class="col-md-3">
                          <div class="form-check-inline">
                            <label class="form-check-label">
                              <input
                                type="checkbox"
                                class="form-check-input"
                                value="หนังสือเรียน"
                                v-model.trim="selected"
                              />หนังสือเรียน
                            </label>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-check-inline">
                            <label class="form-check-label">
                              <input
                                type="checkbox"
                                class="form-check-input"
                                value="อุปกรณ์การเรียน"
                                v-model.trim="selected"
                              />อุปกรณ์การเรียน
                            </label>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <div class="input-group-text">
                                <input
                                  type="checkbox"
                                  value="อื่นๆ"
                                  v-model.trim="selected"
                                />
                              </div>
                            </div>
                            <input
                              type="text"
                              class="form-control"
                              placeholder="กรอกรายการชำระ"
                              v-model.trim="payforDetail"
                            />
                          </div>
                        </div>
                      </div>

                      <!-- <div class="row mx-auto mt-3">
                        <div class="col-md-3">
                          <div class="form-check-inline">
                            <label class="form-check-label">
                              <input
                                type="checkbox"
                                class="form-check-input"
                                value="หนังสือเรียน"
                                v-model="paymentFor"
                              />หนังสือเรียน
                            </label>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-check-inline">
                            <label class="form-check-label">
                              <input
                                type="checkbox"
                                class="form-check-input"
                                value="อุปกรณ์การเรียน"
                                v-model="paymentFor"
                              />อุปกรณ์การเรียน
                            </label>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="input-group mb-3">
                            อื่นๆ
                            <div class="input-group-prepend">
                              <div class="input-group-text">
                                <input
                                  type="checkbox"
                                  value="อื่นๆ"
                                  v-model="paymentFor"
                                />
                              </div>
                            </div>
                            <input
                              type="text"
                              class="form-control"
                              placeholder="รายละเอียดอื่นๆ"
                              v-model="other"
                            />
                          </div>
                        </div>
                      </div> -->
                      <div class="table-responsive">
                        <table
                          class="table table-bordered table-striped text-center"
                        >
                          <thead class="thead-light">
                            <tr>
                              <th>สินค้า</th>
                              <th>จำนวน</th>
                              <th>ราคา/หน่วย</th>
                              <th>ส่วนลด</th>
                              <th>รวม</th>
                              <th>ลบ</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr v-for="(item, index) in carts" :key="index">
                              <td>{{ item.pName }}</td>
                              <td>{{ item.buyAmount }}</td>
                              <td>{{ item.price }}</td>
                              <td>{{ item.pDiscount }}</td>
                              <td>
                                {{
                                  item.buyAmount * item.price - item.pDiscount
                                }}
                              </td>
                              <td>
                                <button
                                  type="button"
                                  @click="deleteProduct(index)"
                                  class="btn btn-danger btn-sm"
                                >
                                  <i class="fas fa-times text-light"></i>
                                </button>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>

                    <div class="py-3" style="border: 1px solid green">
                      <h5 class="text-center text-success mt-3">สรุปยอด</h5>
                      <div class="row mx-auto">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="usr" class="text-success"
                              >ค่าแรกเข้า (Enrollment fee)
                            </label>
                            <input
                              type="number"
                              class="form-control"
                              id="usr"
                              min="0"
                              v-model.trim="fee"
                            />
                          </div>
                        </div>
                      </div>
                      <div class="table-responsive">
                        <table
                          class="table table-bordered table-striped text-center"
                        >
                          <thead class="thead-light">
                            <tr>
                              <th>(1)รวมค่าเรียน</th>
                              <th>(2)ค่าหนังสือหรืออุปกรณ์</th>
                              <th>ค่าแรกเข้า</th>
                              <th>รวมจำนวนเงินทั้งสิ้น</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>{{ subTotal }}</td>
                              <td>{{ pSubtotal }}</td>
                              <td>{{ fee }}</td>
                              <td>{{ grandTotal }}</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>

                      <h6 class="ml-3 text-success">ชำระเงินโดย (Pay By)</h6>
                      <div class="row mx-auto">
                        <div class="col-md-3">
                          <div class="form-check-inline">
                            <label class="form-check-label">
                              <input
                                type="checkbox"
                                class="form-check-input"
                                value="เงินสด"
                                v-model.trim="payBy"
                              />เงินสด
                            </label>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-check-inline">
                            <label class="form-check-label">
                              <input
                                type="checkbox"
                                class="form-check-input"
                                value="เครดิตการ์ด"
                                v-model.trim="payBy"
                              />เครดิตการ์ด
                            </label>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <!-- โอนผ่านธนาคาร -->
                          <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <div class="input-group-text">
                                <input
                                  type="checkbox"
                                  value="โอนผ่านธนาคาร"
                                  v-model.trim="payBy"
                                />
                              </div>
                            </div>
                            <input
                              type="text"
                              class="form-control"
                              placeholder="โอนผ่านบัญชีธนาคาร"
                              v-model.trim="bankDetail"
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group mt-2">
                            <label for="usr" class="text-success"
                              >หมายเหตุ
                            </label>
                            <input
                              type="text"
                              class="form-control"
                              id="usr"
                              placeholder="กรอกรายการโปรโมชั่น"
                              v-model.trim="note"
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group mt-2">
                            <label for="usr" class="text-success"
                              >วัน-เวลาที่ทำธุรกรรม
                            </label>
                            <!-- <input
                              type="text"
                              class="form-control"
                              id="usr"
                              v-model="transactionTime"
                            /> -->
                            <!-- <date-picker v-model.trim="transactionTime" :config="options" locale="th"></date-picker> -->
                            <!-- <Datepicker format="DD/MM/YYYY H:i:s"  v-model="transactionTime" @change="test(e)"></Datepicker> -->
                            <!-- <DatetimePicker></DatetimePicker> -->
                            <input
                              type="datetime-local"
                              class="form-control"
                              v-model="transactionTime"
                            />
                          </div>
                        </div>
                      </div>

                      <div class="row text-center">
                        <div class="col-md-12">
                          <button
                            class="btn btn-primary no-print"
                            @click="confirmInvoice()"
                          >
                            <i class="fas fa-check-circle"></i> ยืนยัน
                          </button>
                          <button
                            class="btn btn-danger no-print ml-3"
                            @click="reset"
                          >
                            <i class="fas fa-redo"></i> Reset/ยกเลิก
                          </button>
                          <button
                            v-if="confirm"
                            class="btn btn-warning no-print ml-3"
                            @click="print"
                          >
                            <i class="fas fa-print"></i> Print
                          </button>
                        </div>
                      </div>
                    </div>
                  </b-card-body>
                </b-collapse>
              </b-card>
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button class="btn btn-danger no-print ml-3" @click="reset">
              <i class="fas fa-redo"></i> Reset
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
          <!-- <b-form-group
            label="Using options array:"
            v-slot="{ ariaDescribedby }"
          >
            <b-form-checkbox-group
              id="checkbox-group-1"
              v-model="selected"
              :options="options"
              :aria-describedby="ariaDescribedby"
              name="flavour-1"
            ></b-form-checkbox-group>
          </b-form-group>

          selected {{ selected }} -->
        </div>
      </div>
    </div>
    <!--End Modal AddCourse -->

    <!--Start Modal Reneval -->
    <div class="modal fade" id="RenevalModal">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Modal Heading</h4>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>

          <!-- Modal body -->
          <div class="modal-body"></div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!--End Modal Reneval -->
  </div>
</template>

<script>
import { db, functions, fb } from "../../firebase.js";
import firebase from "firebase/app";
import moment from "moment";
// import { DatetimePicker } from '@livelybone/vue-datepicker';

export default {
  name: "",
  components: {},
  data() {
    return {
      // options: [
      //   { text: "หนังสือเรียน", value: "หนังสือเรียน" },
      //   { text: "อุปกรณ์การเรียน", value: "อุปกรณ์การเรียน" },
      //   { text: "อื่นๆ", value: "อื่นๆ" },
      // ],
      columns: [
        {
          label: "รหัส",
          field: "studentId",
          type: "text",
        },
        {
          label: "ชื่อ",
          field: "firstName",
          type: "text",
        },
        {
          label: "นามสกุล",
          field: "lastName",
          type: "text",
        },
        {
          label: "ชื่อเล่น",
          field: "nickName",
          type: "text",
        },
        {
          label: "เบอร์โทร",
          field: "mobilephone",
          type: "text",
        },
        {
          label: "สถานะ",
          field: "status",
          type: "text",
        },
        {
          label: "โปร์ไฟล์",
          field: "fullProfile",
          type: "text",
        },
        {
          label: "เพิ่มคอร์ส",
          field: "addcourse",
          type: "text",
        },
        {
          label: "ต่อคอร์ส",
          field: "Reneval",
          type: "text",
        },
        {
          label: "ข้อมูลอื่นๆ",
          field: "data",
          type: "text",
        },
        {
          label: "แก้ไข",
          field: "edit",
          type: "text",
        },
        {
          label: "delete",
          field: "delete",
          type: "text",
        },
      ],
      fruit: null,
      fruits: ["peach", "pear", "apple", "orange"],
      profiles: [],

      profile: {
        uid: "",
        addProfileAt: "",
        image: null,

        namePrefix: "",
        nickName: "",
        firstName: "",
        lastName: "",
        birthday: null,
        email: "",
        telephone: "",
        mobilephone: "",

        address: {
          addressNumber: "",
          location: "",
          soi: "",
          road: "",
          district: "",
          amphoe: "",
          province: "",
          zipcode: "",
        },

        graduated: {
          degree: "",
          university: "",
          faculty: "",
          major: "",
        },
        subject: "",
        studyHis: "",
        profileType: "student",
      },

      pColumns: [
        {
          label: "ชื่อสินค้า",
          field: "pName",
          type: "text",
        },
        {
          label: "รหัสสินค้า",
          field: "pCode",
          type: "text",
        },
        {
          label: "ราคาทุน",
          field: "cost",
          type: "text",
        },
        {
          label: "ราคาขาย",
          field: "price",
          type: "text",
        },
        {
          label: "คงเหลือ",
          field: "quantity",
          type: "text",
        },
        {
          label: "จำนวนสั่งซื้อ",
          field: "buy",
          type: "number",
        },
        {
          label: "ส่วนลด",
          field: "pDiscount",
          type: "number",
        },
        {
          label: "รวม",
          field: "total",
          type: "number",
        },
        {
          label: "cart",
          field: "cart",
          type: "number",
        },
      ],

      courses: [],
      products: [],

      courseSelected: "",
      classTypeSelected: "",
      levelSelected: "",
      priceSelected: 0,
      teacherSelected: "",
      daySelected: "",
      discount: 0,
      amount: 12,
      startTime: "",
      wages: 0,
      finishTime: "",
      startDate: "",
      endDate: "",
      qty: 1,
      paymentType: null,
      paymentFor: [],
      selected: [],
      other: null,
      payBy: [],
      payforDetail: "",
      bankDetail: "",
      note: null,
      transactionTime: null,

      cName: [],
      cType: [],
      cLevel: [],
      cRate: [],
      cTeacher: [],
      cDay: ["จันทร์", "อังคาร", "พุธ", "พฤหัส", "ศุกร์", "เสาร์", "อาทิตย์"],

      std: {
        // stdId:null,
        // nickName:null,
        // firstName:null,
        // lastName:null,
        // date: Daye.now()
      },
      day: moment().add(543, "year").format("LL"),
      invoiceNo: null,

      carts: [],
      buyAmount: 0,
      pDiscount: 0,

      confirm: false,
      courseInfo: [],
      teacherId: null,
      teacherName: null,

      profileModal: null,

      disabled: 0,
      fee: 300,
    };
  },

  computed: {
    dateFormat() {
      return moment(this.startDate).format("DD/MM/YYYY");
    },

    subTotal() {
      var total = this.courses.reduce((accumulator, item) => {
        return accumulator + item.priceSelected * item.qty - item.discount;
      }, 0);
      return total;
    },

    pSubtotal() {
      var ptotal = this.carts.reduce((accumulator, item) => {
        return accumulator + item.price * item.buyAmount - item.pDiscount;
      }, 0);
      return ptotal;
    },

    grandTotal() {
      var total = this.subTotal + this.pSubtotal + parseInt(this.fee);
      return total;
    },
  },
  // watch: {
  //   clonedItems: function (newVal, oldVal) {
  //     console.log(newVal);
  //     console.log(oldVal);
  //   },
  // },

  methods: {
    changeStatus(uid, event) {
      console.log(event.target.value);
      var addMessage = functions.httpsCallable("ApproveStudent");
      var data = { uid: uid, role: { [event.target.value]: true } };
      addMessage(data)
        .then((result) => {
          // console.log(result);

          Swal.fire({
            title: "ทำการปรับสถานะเรียบร้อย",
            text: "Admin ได้ทำการปรับสถานะ นักเรียน แล้วเรียบร้อย",
            icon: "success",
            confirmButtonColor: "#30855c",
            confirmButtonText: "ตกลง",
          });
        })
        .catch((error) => {
          Swal.fire({
            title: "เกิดข้อผิดพลาด",
            text: "เกิดข้อผิดพลาดที่ระบบ กรุณาลองใหม่อีกครั้ง",
            icon: "warning",
            confirmButtonColor: "#FF0000",
            confirmButtonText: "ตกลง",
          });
        });
    },

    namePrefixHis(profile, newValue) {
      if (this.profile.namePrefix == profile.namePrefix) {
        // alert("ข้อมูลใหม่" + newValue.target.value);

        var sfRef = db.collection("stdHis");
        sfRef.add({
          oldNamePrefix: profile.namePrefix,
          newNamePrefix: newValue.target.value,
          stdId: profile.studentId,
          timeToChange: Date.now(),
        });
        this.profile.namePrefix = newValue.target.value;
      }

      // console.log("ข้อมูลเก่า " + profile);
      // console.log("ข้อมูลใหม่ " + newValue.target.value);
      // this.profile.namePrefix = newValue.target.value;
    },

    stdProHis(profile, newValue) {
      if (this.profile.nickName == profile.nickName) {
        // alert("ข้อมูลใหม่" + newValue.target.value);

        var sfRef = db.collection("stdHis");
        sfRef.add({
          oldNamePrefix: profile.nickName,
          newNamePrefix: newValue.target.value,
          stdId: profile.studentId,
          timeToChange: Date.now(),
        });
        this.profile.nickName = newValue.target.value;
      }

      // console.log("ข้อมูลเก่า " + profile);
      // console.log("ข้อมูลใหม่ " + newValue.target.value);
      // this.profile.namePrefix = newValue.target.value;
    },
    updateProfile(uid) {
      // console.log(this.profile);
      db.collection("studentData")
        .doc(uid)
        .update(this.profile)
        .then(() => {
          Swal.fire({
            title: "อัพเดทข้อมูล",
            text: "ได้ทำการupdateสินค้าเรียบร้อย",
            icon: "success",
            confirmButtonColor: "#30855c",
            confirmButtonText: "ตกลง",
          });
          // $("#product").modal("hide");
        });
      // try {
      //   var batch = db.batch();

      //   var sfRef = db.collection("studentData").doc(uid);
      //   batch.update(sfRef, { population: 1000000 });
      //   batch.commit();
      //   console.log("เพิ่มคอร์สเรียนเรียบร้อย");
      // } catch (err) {
      //   console.log(err);
      // }
    },
    editprofile(profile) {
      this.profileModal = "edit";
      this.profile = profile;
      this.disabled = 0;
    },
    test(e) {
      console.log(this.transactionTime);
    },
    reset() {
      location.reload();
    },

    activeCourse() {
      // console.log(this.std.mobilephone);
      try {
        var batch = db.batch();
        this.courses.forEach((item) => {
          let data = {
            uid: this.std.uid,
            studentId: this.std.studentId,
            firstName: this.std.firstName,
            lastName: this.std.lastName,
            nickName: this.std.nickName,
            mobilephone: this.std.mobilephone,
            courseName: item.courseSelected,
            amount: item.amount,
            classType: item.classTypeSelected,
            invoiceNo: this.invoiceNo,

            day: item.daySelected,
            discount: item.discount,
            finishTime: item.finishTime,
            level: item.levelSelected,
            price: item.priceSelected,
            qty: item.qty,
            startDate: moment(item.startDate).format("x"),
            endDate: moment(item.endDate).format("x"),
            startTime: item.startTime,
            wages: item.wages,

            teacherName: item.teacherSelected,
            // teacherId: item.teacherSelected.teacherId,
          };

          batch.set(db.collection("courseActive").doc(), data);
        });

        this.carts.forEach((item) => {
          var newQty = item.quantity - item.buyAmount;
          console.log(newQty);
          batch.update(db.collection("products").doc(item.pID), {
            quantity: newQty,
          });
        });

        batch.commit();
        console.log("เพิ่มคอร์สเรียนเรียบร้อย");

        //  this.carts = [];
        this.addInvoice();
      } catch (err) {
        console.log(err);
      }
    },

    async addInvoice() {
      // console.log(invoiceData);
      // $('#addCourseModal').modal('hide')
      try {
        this.courseInfo = [];
        this.courses.forEach((item) => {
          let data = {
            uid: this.std.uid,
            studentId: this.std.studentId,
            firstName: this.std.firstName,
            lastName: this.std.lastName,
            nickName: this.std.nickName,
            mobilephone: this.std.mobilephone,
            courseName: item.courseSelected,
            amount: item.amount,
            classType: item.classTypeSelected,
            day: item.daySelected,
            discount: item.discount,
            endDate: item.endDate,
            finishTime: item.finishTime,
            level: item.levelSelected,
            price: item.priceSelected,
            qty: item.qty,
            startDate: item.startDate,
            startTime: item.startTime,
            wages: item.wages,
            teacherName: item.teacherSelected.teacherName,
            teacherId: item.teacherSelected.teacherId,
          };

          this.courseInfo.push(data);
          // console.log(this.courseInfo);
          // this.courseInfo = []
          // item.teacher.forEach((detail)=>{
          //   let data = {
          //     teacherName : detail.fullName,
          //     teacherId : detail.uid,
          //   }
          //       this.courseInfo.push(data)
          //       console.log(this.courseInfo);
          // })
        });

        let invoiceData = {
          uid: this.std.uid,
          studentId: this.std.studentId,
          firstName: this.std.firstName,
          lastName: this.std.lastName,
          nickName: this.std.nickName,
          payBy: this.payBy,
          payforDetail: this.payforDetail,
          bankDetail: this.bankDetail,
          invoiceNo: this.invoiceNo,
          paymentType: this.paymentType,

          courseDetail: this.courseInfo,
          productDetail: this.carts,

          pSubtotal: this.pSubtotal,
          subTotal: this.subTotal,
          grandTotal: this.grandTotal,
          fee: this.fee,

          paymentFor: this.selected,
          other: this.other,
          note: this.note,
          transactionTime: this.transactionTime,
          invoiceTime: moment().format("DD/MM/YYYY"),
          invoiceTimestamp: moment().format("x"),
          invDayOfWeek: moment().isoWeekday(),
          invDayOfMonth: moment().date(),
          invMonth: moment().month() + 1,
          invYear: moment().year(),
          canUpdate: false,
        };

        await db.collection("invoiceData").add(invoiceData);
        Swal.fire({
          title: "เรียบร้อย",
          text: "ได้ทำการเพิ่มสินค้าแล้วเรียบร้อย",
          icon: "success",
          confirmButtonColor: "#30855c",
          confirmButtonText: "ตกลง",
        });
        this.updateInvoiceId();
      } catch (err) {
        Swal.fire({
          title: "Add Course เกิดข้อผิดพลาด",
          text: "เกิดข้อผิดพลาดบางอย่าง กรุณารอและทำรายการใหม่",
          icon: "error",
          confirmButtonColor: "#FF0000",
          confirmButtonText: "ตกลง",
        });
      }
    },

    async updateInvoiceId() {
      await db
        .collection("invoiceId")
        .doc("detail")
        .update({ invoiceNo: firebase.firestore.FieldValue.increment(1) });
      this.confirm = true;
      console.log("จบการทำงาน");
      // console.log(product.pID);
      // this.$store.state.show = true;
      // var Ref = db.collection("products").doc(product.pID);
      // try {
      //   await db
      //     .runTransaction((transaction) => {
      //       return transaction.get(Ref).then((sfDoc) => {
      //         if(!sfDoc.exists) {
      //           throw "Document does not exist!";
      //         }
      //         var newQuantity=sfDoc.data().quantity-product.buyAmount;
      //         transaction.update(Ref, { quantity: newQuantity });
      //       });
      //     });
      //   Swal.fire({
      //     title: "Add To Cart",
      //     text: "เพิ่มสินค้าลงตระกร้าเรียบร้อยแล้ว",
      //     icon: "success",
      //     confirmButtonColor: "#30855c",
      //     confirmButtonText: "ตกลง",
      //   });
      //   this.carts.push(product);
      //   this.$store.state.show=false;
      //   console.log(this.cart);
      // } catch(error) {
      //   console.log("Transaction failed: ", error);
      //   Swal.fire({
      //     title: "เกิดข้อผิดพลาดที่ระบบ",
      //     text: "ไม่สามารถตัดยอดสินค้าได้ กรุณาลองใหม่อีกครั้ง",
      //     icon: "warning",
      //     confirmButtonColor: "#FF0000",
      //     confirmButtonText: "ตกลง",
      //   });
      //   this.$store.state.show=false;
      // }
    },

    async confirmInvoice() {
      if (this.payBy.length != 0) {
        this.getInvoiceId();
      } else {
        Swal.fire({
          title: "ไม่มีข้อมูลการชำระเงิน",
          text: "ตรวจสอบวิธีชำระเงินใหม่อีกครั้งที่ ชำระเงินโดย (Pay By)",
          icon: "error",
          confirmButtonColor: "#FF0000",
          confirmButtonText: "ตกลง",
        });
      }

      // console.log(invoiceData);
      // try {
      //   this.courseInfo = [];
      //   this.courses.forEach((item) => {
      //     let data = {
      //       uid: this.std.uid,
      //       studentId: this.std.studentId,
      //       firstName: this.std.firstName,
      //       lastName: this.std.lastName,
      //       nickName: this.std.nickName,
      //       courseName: item.courseSelected,
      //       amount: item.amount,
      //       classType: item.classTypeSelected,
      //       day: item.daySelected,
      //       discount: item.discount,
      //       endDate: item.endDate,
      //       finishTime: item.finishTime,
      //       level: item.levelSelected,
      //       price: item.priceSelected,
      //       qty: item.qty,
      //       startDate: item.startDate,
      //       startTime: item.startTime,
      //       teacherName: item.teacherSelected.teacherName,
      //       teacherId: item.teacherSelected.teacherId,
      //     };

      //     this.courseInfo.push(data);
      //     console.log(this.courseInfo);
      //     // this.courseInfo = []
      //     // item.teacher.forEach((detail)=>{
      //     //   let data = {
      //     //     teacherName : detail.fullName,
      //     //     teacherId : detail.uid,
      //     //   }
      //     //       this.courseInfo.push(data)
      //     //       console.log(this.courseInfo);
      //     // })
      //   });

      //   let invoiceData = {
      //     uid: this.std.uid,
      //     studentId: this.std.studentId,
      //     firstName: this.std.firstName,
      //     lastName: this.std.lastName,
      //     nickName: this.std.nickName,
      //     payBy: this.payBy,
      //     invoiceNo: invoiceNo,
      //     paymentType: this.paymentType,

      //     courseDetail: this.courseInfo,
      //     productDetail: this.carts,
      //     subTotal: this.subTotal,
      //     grandTotal: this.grandTotal,
      //     fee: this.fee,

      //     paymentFor: this.paymentFor,
      //     other: this.other,
      //     note: this.note,
      //     transactionTime: this.transactionTime,
      //   };

      //   await db.collection("invoiceData").add(invoiceData);
      //   Swal.fire({
      //     title: "เรียบร้อย",
      //     text: "ได้ทำการเพิ่มสินค้าแล้วเรียบร้อย",
      //     icon: "success",
      //     confirmButtonColor: "#30855c",
      //     confirmButtonText: "ตกลง",
      //   });
      // } catch (err) {
      //   Swal.fire({
      //     title: "เกิดข้อผิดพลาด",
      //     text: "เกิดข้อผิดพลาดบางอย่าง กรุณารอและทำรายการใหม่",
      //     icon: "error",
      //     confirmButtonColor: "#FF0000",
      //     confirmButtonText: "ตกลง",
      //   });
      // }
      // this.confirm = true;
    },

    addToCart(product) {
      console.log(product);
      this.carts.push(product);
      // console.log(this.carts);
      // console.log(product.pID);
      // this.$store.state.show = true;
      // var Ref = db.collection("products").doc(product.pID);
      // return db
      //   .runTransaction((transaction) => {
      //     return transaction.get(Ref).then((sfDoc) => {
      //       if (!sfDoc.exists) {
      //         throw "Document does not exist!";
      //       }
      //       var newQuantity = sfDoc.data().quantity - product.buyAmount;
      //       transaction.update(Ref, { quantity: newQuantity });
      //     });
      //   })
      //   .then(() => {
      //     Swal.fire({
      //       title: "Add To Cart",
      //       text: "เพิ่มสินค้าลงตระกร้าเรียบร้อยแล้ว",
      //       icon: "success",
      //       confirmButtonColor: "#30855c",
      //       confirmButtonText: "ตกลง",
      //     });
      //     this.carts.push(product);
      //     this.$store.state.show = false;
      //     console.log(this.cart);
      //   })
      //   .catch((error) => {
      //     console.log("Transaction failed: ", error);
      //     Swal.fire({
      //       title: "เกิดข้อผิดพลาดที่ระบบ",
      //       text: "ไม่สามารถตัดยอดสินค้าได้ กรุณาลองใหม่อีกครั้ง",
      //       icon: "warning",
      //       confirmButtonColor: "#FF0000",
      //       confirmButtonText: "ตกลง",
      //     });
      //     this.$store.state.show = false;
      //   });
      Swal.fire({
        title: "Add To Cart",
        text: "เพิ่มสินค้าลงตระกร้าเรียบร้อยแล้ว",
        icon: "success",
        confirmButtonColor: "#30855c",
        confirmButtonText: "ตกลง",
      });
      console.log(this.carts);
    },

    decimalDigits(value) {
      return value.toFixed(this.invoiceCurrency.decimal_digits);
    },
    print() {
      // Pass the element id here
      // window.print();
      this.$htmlToPaper("InvPckPrint");
      // this.carts = [];
      // this.reset()
    },

    addcourse(std) {
      console.log(std);
      // console.log(uid);
      // this.$router.push({ name: "addcourse", params: { uid } });
      // (this.day = moment(Date.now()).format("DD/MM/YYYY")), console.log();
      this.std = std;
    },

    addToInvoice() {
      let data = {
        studentId: this.std.studentId,
      };
      console.log(data);
    },

    async getProducts() {
      try {
        this.$store.state.show = true;
        db.collection("products").onSnapshot((querySnapshot) => {
          this.products = [];
          querySnapshot.forEach((doc) => {
            let product = {
              pName: doc.data().pName,
              pMode: doc.data().pMode,
              pCode: doc.data().pCode,
              cost: doc.data().cost,
              price: doc.data().price,
              quantity: doc.data().quantity,
              buyAmount: 0,
              pDiscount: 0,
              pID: doc.id,
            };
            this.products.push(product);
          });
        });
        // this.$store.state.show = true;
        // let Ref = await db.collection("products").get();
        // if (Ref.empty) {
        //   console.log("No matching documents.");
        //   return;
        // }
        // this.products = [];
        // Ref.forEach((doc) => {
        //   let product = {
        //     pName: doc.data().pName,
        //     pCode: doc.data().pCode,
        //     cost: doc.data().cost,
        //     price: doc.data().price,
        //     quantity: doc.data().quantity,
        //     buyAmount: 0,
        //     pID: doc.id,
        //   };
        //   this.products.push(product);
        //   console.log(this.products);
        // });
        this.$store.state.show = false;
      } catch (err) {
        Swal.fire({
          title: "เกิดข้อผิดพลาดที่ระบบ",
          text: "ไม่สามารถดึงข้อมูลสินค้าได้ กรุณาลองใหม่อีกครั้ง",
          icon: "warning",
          confirmButtonColor: "#FF0000",
          confirmButtonText: "ตกลง",
        });
        this.$store.state.show = false;
      }
    },

    async getCourseTemplate() {
      try {
        this.$store.state.show = true;
        const doc = await db.collection("courseTemplate").doc("detail").get();
        if (doc.empty) {
          console.log("No matching documents.");
          return;
        }
        this.cName = doc.data().courseName;
        this.cType = doc.data().courseType;
        this.cLevel = doc.data().level;
        this.cRate = doc.data().rate;
        this.cTeacher = doc.data().teacher;

        console.log(this.cTeacher);
        this.addNewItem();
        this.$store.state.show = false;
      } catch (err) {
        Swal.fire({
          title: "เกิดข้อผิดพลาดที่ระบบ",
          text: "ไม่สามารถดึงข้อมูล course เรียนได้ กรุณาลองใหม่อีกครั้ง",
          icon: "warning",
          confirmButtonColor: "#FF0000",
          confirmButtonText: "ตกลง",
        });
        this.$store.state.show = false;
      }
    },

    deleteItem(index) {
      console.log(index);
      this.courses.splice(index, 1);
    },

    deleteProduct(index) {
      // console.log(index);
      this.carts.splice(index, 1);
    },

    addNewProduct() {},

    addNewItem() {
      this.courses.push({
        courseSelected: "",
        classTypeSelected: "",
        levelSelected: "",
        priceSelected: "",
        teacherSelected: "",
        daySelected: "",
        discount: 0,
        amount: 12,
        startTime: "",
        wages: 0,
        finishTime: "",
        startDate: "",
        endDate: "",
        qty: 1,
        // endDate:  moment(this.startDate).add(3,'M').format('YYYY-MM-DD'),

        courseName: this.cName,
        courseType: this.cType,
        level: this.cLevel,
        rate: this.cRate,
        teacher: this.cTeacher,
        day: this.cDay,
      });
      console.log(this.courses);
    },

    deleteTeacher(doc) {
      Swal.fire({
        title: "ต้องการลบ?",
        text: "ทำการลบแล้วไม่สามารถย้อนกลับได้",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#30855c",
        cancelButtonColor: "#d33",
        confirmButtonText: "ตกลง ลบข้อมูล",
      }).then((result) => {
        if (result.value) {
          // console.log(doc)
          db.collection("teacherData")
            .doc(doc)
            .delete()
            .then(() => {
              Swal.fire({
                title: "ทำการลบเรียบร้อย",
                text: "ได้ทำการลบผู้ใช้งานนี้เรียบร้อย",
                icon: "success",
                confirmButtonColor: "#30855c",
                confirmButtonText: "ตกลง",
              });
            });
        }
      });
    },

    async getInvoiceId() {
      try {
        this.$store.state.show = true;
        var ref = db.collection("invoiceId").doc("detail");
        let doc = await ref.get();
        if (!doc.exists) {
          await ref.set(
            {
              invoiceNo: 1,
            },
            { merge: true }
          );
          location.reload();
          this.$store.state.show = false;
        }
        let str = doc.data().invoiceNo.toString();
        this.invoiceNo = str.padStart(3, "0");

        console.log(this.invoiceNo);
        this.activeCourse();

        this.$store.state.show = false;
      } catch (err) {
        Swal.fire({
          title: "เกิดข้อผิดพลาด",
          text: "ไม่สามารถดึงรหัสนักเรียนได้ กรุณาลองใหม่อีกครั้ง",
          icon: "warning",
          confirmButtonColor: "#FF0000",
          confirmButtonText: "ตกลง",
        });
        this.$store.state.show = false;
      }
    },

    fullProfile(profile) {
      // alert(profile.firstName);
      this.profileModal = null;
      this.profile = profile;
      this.disabled = 1;
    },

    getStudentData() {
      try {
        this.$store.state.show = true;
        db.collection("studentData")
          .orderBy("addProfileAt", "desc")
          .onSnapshot((querySnapshot) => {
            this.profiles = [];
            querySnapshot.forEach((doc) => {
              console.log(doc.data());
              let profile = {
                uid: doc.id,
                studentId: doc.data().studentId,
                addProfileAt: moment(doc.data().addProfileAt).format(
                  "DD/MM/YYYY HH:mm:ss"
                ),
                image: doc.data().image,

                namePrefix: doc.data().namePrefix,
                nickName: doc.data().nickName,
                firstName: doc.data().firstName,
                lastName: doc.data().lastName,
                birthday: doc.data().birthday,
                email: doc.data().email,
                telephone: doc.data().telephone,
                mobilephone: doc.data().mobilephone,

                parentFirstName: doc.data().parentFirstName,
                parentLastName: doc.data().parentLastName,
                parentEmail: doc.data().parentEmail,
                parentMobilephone: doc.data().parentMobilephone,
                parentAbout: doc.data().parentAbout,
                profileType: "student",

                address: {
                  addressNumber: doc.data().address.addressNumber,
                  location: doc.data().address.location,
                  soi: doc.data().address.soi,
                  road: doc.data().address.road,
                  district: doc.data().address.district,
                  amphoe: doc.data().address.amphoe,
                  province: doc.data().address.province,
                  zipcode: doc.data().address.zipcode,
                },

                graduated: {
                  degree: doc.data().graduated.degree,
                  university: doc.data().graduated.university,
                  faculty: doc.data().graduated.faculty,
                  major: doc.data().graduated.major,
                },

                role: doc.data().role,
                studyHis: doc.data().studyHis,
                commited: "นักเรียน",
              };
              this.profiles.push(profile);
            });
            this.$store.state.show = false;
          });
      } catch (err) {
        console.log(err);
        this.$store.state.show = false;
      }
    },
  },

  mounted() {
    window.scrollTo(0, 0);
  },

  created() {
    this.getStudentData();
    this.getCourseTemplate();
    this.getProducts();
  },
  // ขั้นตอนการทำงาน confirmInvoice() ->  getInvoiceId() ->
  // activeCourse() -> ตัดสต็อค -> addInvoice()
};
</script>

<style lang="scss" scoped>
#preview {
  display: flex;
  justify-content: center;
  align-items: center;
}

#preview img {
  max-width: 100%;
  max-height: 500px;
}
.btn-circle {
  width: 30px;
  height: 30px;
  text-align: center;
  padding: 6px 0;
  font-size: 12px;
  line-height: 1.428571429;
  border-radius: 15px;
}
.shipper-name {
  border-top: 3px #000000 solid;
}
.text-center {
  text-align: center;
}
table.table-border,
table.table-border th,
table.table-border td {
  border-collapse: collapse;
  border: 1px #000000 solid;
}
div.page {
  background: white;
  display: block;
  margin: 0 auto;
  // margin-bottom: 0.5 cm;
  box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
}
div.page[size="A4"] {
  width: 21cm;
  height: 29.7cm;
  // height: 14.85cm;
}
@media print {
  div.page {
    margin: 0;
    box-shadow: 0;
  }
  .no-print,
  .no-print * {
    display: none !important;
  }
}
</style>





                    <div class="mt-3">
                      <div class="row text-left">
                        <div class="col-lg-4 col-md-6">
                          <div>
                            Inv No.
                            <span class="text-success">{{
                              profile.invoiceNo
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            ชั้นเรียน
                            <span class="text-success">{{
                              profile.classType
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            วันที่
                            <span class="text-success">{{
                              profile.nowDate
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            ชื่อ-นามสกุล
                            <span class="text-success"
                              >{{ profile.firstName }}
                              {{ profile.lastName }}</span
                            >
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            รหัสนักเรียน
                            <span class="text-success">{{
                              profile.studentId
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            ชื่อเล่น
                            <span class="text-success">{{
                              profile.nickName
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            ชื่อ-นามสกุล ครู
                            <span class="text-success">{{
                              profile.teacherfullName
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            วันเรียน
                            <span class="text-success">{{ profile.day }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            เวลาเรียน
                            <span class="text-success"
                              >{{ profile.startTime }}-{{
                                profile.finishTime
                              }}</span
                            >
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            เบอร์โทร
                            <span class="text-success">{{
                              profile.mobilephone
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            วิชา
                            <span class="text-success">{{
                              profile.courseName
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            จำนวน ชม.
                            <span class="text-success">{{
                              profile.amount
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            โปรโมชั่น
                            <span class="text-success"
                              >เซตเสือน้อย5%แถมฟรี1ครั้ง</span
                            >
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            วันที่เริ่มเรียน
                            <span class="text-success">{{
                              profile.startDate
                            }}</span>
                          </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                          <div>
                            วันที่เรียนจบ
                            <span class="text-success">{{
                              profile.endDate
                            }}</span>
                          </div>
                        </div>
                      </div>
                    </div>